<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, viewport-fit=cover">
    <title>Newser</title>
    <style>
        :root { --ios-bg: #f2f2f7; --ios-card: #ffffff; --ios-text: #000000; --ios-secondary: #636366; --ios-accent: #007aff; --trending: #ff3b30; --separator: #d1d1d6; }
        @media (prefers-color-scheme: dark) { :root { --ios-bg: #000000; --ios-card: #1c1c1e; --ios-text: #ffffff; --ios-secondary: #8e8e93; --ios-accent: #0a84ff; --trending: #ff453a; --separator: #38383a; } }
        body { font-family: -apple-system, sans-serif; background: var(--ios-bg); color: var(--ios-text); margin: 0; padding: env(safe-area-inset-top) 16px 100px 16px; -webkit-font-smoothing: antialiased; }
        .container { max-width: 600px; margin: 0 auto; }
        .article-card { background: var(--ios-card); padding: 22px 18px; border-bottom: 0.5px solid var(--separator); cursor: pointer; }
        
        /* DEATH TRACKER STYLE */
        .death-alert-card { background: #e06666 !important; border-left: 6px solid #990000 !important; }
        .death-alert-card .article-link { color: #ffffff !important; }
        .death-alert-card .meta { color: #ffeaea !important; }

        .article-link { font-weight: 600; font-size: 21px; line-height: 1.3; margin-bottom: 8px; color: var(--ios-text); }
        .meta { font-size: 14px; color: var(--ios-secondary); display: flex; align-items: center; }
        .done-btn { background: var(--ios-accent); color: white; border: none; width: 100%; padding: 20px; border-radius: 16px; font-size: 20px; font-weight: 700; margin-top: 40px; cursor: pointer; }
    </style>
</head>
<body>
<div class="container">
    <header><h1>Newser</h1><div id="update-display">Connecting...</div></header>
    <div id="content" style="display:none;">
        <section id="death-tracker-wrapper" style="display:none;"><h2>üíÄ Death Tracker</h2><div id="death-tracker-list" class="list-group"></div></section>
        <section id="headlines-wrapper"><h2>üóûÔ∏è Headlines</h2><div id="headlines-list" class="list-group"></div></section>
        <button class="done-btn" onclick="markAsDone()">Done for Now</button>
    </div>
</div>

<script>
    const API_URL = "PASTE_YOUR_DEPLOYMENT_URL_HERE"; 

    async function fetchNews() {
        try {
            const response = await fetch(API_URL + "?t=" + new Date().getTime());
            const data = await response.json();
            document.getElementById('update-display').innerText = "Last catch-up: " + new Date(data.refreshTime).toLocaleString();
            
            const dtList = document.getElementById('death-tracker-list'), hdList = document.getElementById('headlines-list');
            dtList.innerHTML = ''; hdList.innerHTML = '';

            data.articles.forEach((item) => {
                const allSources = JSON.parse(item.link), div = document.createElement('div');
                div.className = 'article-card';

                if (item.repeats === -3) {
                    div.classList.add('death-alert-card');
                    div.innerHTML = `<div class="article-link">${item.title}</div><div class="meta">TAP TO VERIFY VIA GOOGLE</div>`;
                    div.onclick = () => window.open(allSources[0].link, '_blank');
                    dtList.appendChild(div);
                } else {
                    div.innerHTML = `<div class="article-link">${item.title}</div><div class="meta"><span>${new Date(item.timestamp).toLocaleTimeString()}</span></div>`;
                    div.onclick = () => window.open(allSources[0].link, '_blank');
                    hdList.appendChild(div);
                }
            });

            document.getElementById('death-tracker-wrapper').style.display = dtList.children.length > 0 ? 'block' : 'none';
            document.getElementById('content').style.display = 'block';
        } catch (e) { document.getElementById('update-display').innerText = "Connection Error"; }
    }

    async function markAsDone() { 
        if(confirm("Clear list?")) { 
            // This tells the script to clear the temporary Data sheet
            await fetch(API_URL + "?action=clear"); 
            location.reload(); 
        } 
    }
    fetchNews();
</script>
</body>
</html>
