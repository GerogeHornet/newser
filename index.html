<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Newser Stats</title>
    <style>
        body { font-family: -apple-system, sans-serif; background: #000; color: #fff; padding: 20px; }
        .stats { display: flex; gap: 10px; margin-bottom: 20px; }
        .pill { background: #1c1c1e; padding: 10px 20px; border-radius: 20px; font-weight: bold; border: 1px solid #38383a; }
        .list { background: #1c1c1e; border-radius: 12px; }
        .item { padding: 15px; border-bottom: 1px solid #38383a; display: block; color: #fff; text-decoration: none; }
    </style>
</head>
<body>
    <div class="stats">
        <div id="axCount" class="pill">Axios: --</div>
        <div id="memCount" class="pill">Memo: --</div>
    </div>
    <div id="feed" class="list">Loading...</div>

    <script>
        // CRITICAL: Ensure this is the "/exec" URL from your New Deployment
        const API_URL = "https://script.google.com/macros/s/AKfycbyLYvUaKUZ2QLz0qFtXnl7fbZ7-EyX9w0HLQ-G2Y5hWqBEPPk0GHzzTjebaHdn4ZVupTA/exec";

        async function getNews() {
            const feedElement = document.getElementById('feed');
            try {
                const res = await fetch(API_URL);
                
                // If the script sent back an error page, this will fail gracefully
                const text = await res.text();
                let data;
                try {
                    data = JSON.parse(text);
                } catch(e) {
                    throw new Error("Script returned invalid data. Check permissions.");
                }

                document.getElementById('axCount').innerText = `Axios: ${data.axiosCount}`;
                document.getElementById('memCount').innerText = `Memo: ${data.memoCount}`;
                
                feedElement.innerHTML = data.articles.length > 0 ? '' : 'No new articles in sheet.';
                data.articles.forEach(a => {
                    const div = document.createElement('a');
                    div.className = 'item';
                    div.href = a.link;
                    div.target = "_blank";
                    div.innerHTML = `<div>${a.title}</div><small style="color:gray">${new Date(a.timestamp).toLocaleTimeString()}</small>`;
                    feedElement.appendChild(div);
                });
            } catch (e) { 
                feedElement.innerText = "Error: " + e.message; 
            }
        }
        getNews();
    </script>
</body>
</html>
