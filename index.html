<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, viewport-fit=cover">
    <title>Newser</title>
    <style>
        :root { --ios-bg: #f2f2f7; --ios-card: #ffffff; --ios-text: #000000; --ios-accent: #007aff; --separator: #d1d1d6; }
        @media (prefers-color-scheme: dark) { :root { --ios-bg: #000000; --ios-card: #1c1c1e; --ios-text: #ffffff; --ios-accent: #0a84ff; --separator: #38383a; } }
        body { font-family: -apple-system, sans-serif; background: var(--ios-bg); color: var(--ios-text); margin: 0; padding: env(safe-area-inset-top) 16px 100px 16px; }
        .article-card { background: var(--ios-card); padding: 20px; border-bottom: 0.5px solid var(--separator); cursor: pointer; }
        
        /* TIMED KNOWLEDGE ALERT STYLE */
        .tk-alert-card { 
            background: #e06666 !important; 
            border-left: 6px solid #990000 !important; 
            margin-bottom: 10px;
            border-radius: 12px;
        }
        .tk-alert-card .article-link { color: #ffffff !important; font-weight: 700; }
        .tk-alert-card .meta { color: #ffeaea !important; }

        .article-link { font-weight: 600; font-size: 20px; line-height: 1.3; margin-bottom: 5px; }
        .meta { font-size: 14px; color: #8e8e93; }

        /* Overlay for Perplexity Responses */
        #response-overlay { position: fixed; top: 0; left: 0; width: 100%; height: 100%; background: var(--ios-bg); z-index: 9999; display: none; flex-direction: column; }
        #overlay-header { padding: 20px; border-bottom: 0.5px solid var(--separator); display: flex; justify-content: space-between; align-items: center; }
        #overlay-body { padding: 20px; overflow-y: auto; font-size: 18px; line-height: 1.6; }
    </style>
</head>
<body>

<div id="response-overlay">
    <div id="overlay-header">
        <h2 id="overlay-title" style="margin:0;">Response</h2>
        <button onclick="closeOverlay()" style="background:none; border:none; color:var(--ios-accent); font-size:18px; font-weight:600;">Done</button>
    </div>
    <div id="overlay-body"></div>
</div>

<div class="container">
    <header><h1>Newser</h1></header>
    <div id="content">
        <section id="tk-section" style="display:none;">
            <h2>üí° Timed Knowledge</h2>
            <div id="tk-list"></div>
        </section>
        <section id="news-section">
            <h2>üóûÔ∏è Headlines</h2>
            <div id="headlines-list"></div>
        </section>
    </div>
</div>

<script>
    const API_URL = "https://script.google.com/macros/s/AKfycbyLYvUaKUZ2QLz0qFtXnl7fbZ7-EyX9w0HLQ-G2Y5hWqBEPPk0GHzzTjebaHdn4ZVupTA/exec";

    async function fetchNews() {
        const response = await fetch(API_URL);
        const data = await response.json();
        const tkList = document.getElementById('tk-list');
        const hdList = document.getElementById('headlines-list');

        data.articles.forEach(item => {
            const div = document.createElement('div');
            const details = JSON.parse(item.link);
            
            if (item.repeats === -4) {
                div.className = 'article-card tk-alert-card';
                div.innerHTML = `<div class="article-link">${item.title}</div><div class="meta">Timed Knowledge Alert</div>`;
                div.onclick = () => openOverlay(item.title, details[0].body);
                tkList.appendChild(div);
                document.getElementById('tk-section').style.display = 'block';
            } else {
                div.className = 'article-card';
                div.innerHTML = `<div class="article-link">${item.title}</div><div class="meta">${new Date(item.timestamp).toLocaleTimeString()}</div>`;
                div.onclick = () => window.open(details[0].link, '_blank');
                hdList.appendChild(div);
            }
        });
    }

    function openOverlay(title, body) {
        document.getElementById('overlay-title').innerText = title;
        document.getElementById('overlay-body').innerHTML = body.replace(/\n/g, '<br>');
        document.getElementById('response-overlay').style.display = 'flex';
    }

    function closeOverlay() {
        document.getElementById('response-overlay').style.display = 'none';
    }

    fetchNews();
</script>
</body>
</html>
